name: Build

on:
  push:
    branches: [main]
  pull_request:
    branches: [main]

jobs:
  build-spec:
    name: Build - Spec
    runs-on: ubuntu-latest

    steps:
    - name: Checkout
      uses: actions/checkout@v4
      with:
        fetch-depth: 0

    - name: Setup - .NET
      uses: actions/setup-dotnet@v4
      with:
        dotnet-version: 6.0.x # for GitVersion

    - name: Setup - GitVersion
      uses: gittools/actions/gitversion/setup@v1
      with:
        versionSpec: "5.12.0"

    - name: Setup - Bun
      uses: oven-sh/setup-bun@v2
      with:
        bun-version: latest

    - name: Generate - Version
      id: gitversion
      uses: gittools/actions/gitversion/execute@v1
      with:
        useConfigFile: true
        configFilePath: "GitVersion.yml"

    - name: Replace - Version
      run: sed -i 's/0.0.0/${{ steps.gitversion.outputs.legacySemVerPadded }}/g' openapi/openapi.yml

    - name: Bun - Install
      run: bun install --frozen-lockfile

    - name: Bun - Lint
      run: bun run lint

    - name: Bun - Build
      run: bun run build

    - name: Upload - Spec
      uses: actions/upload-artifact@v4
      with:
        name: spec
        path: dist
